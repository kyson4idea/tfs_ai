package com.smy.tfs.api.service;

import com.smy.tfs.SpringTestCase;
import com.smy.tfs.api.dto.*;
import com.smy.tfs.api.dto.base.AccountInfo;
import com.smy.tfs.api.dto.base.Response;
import com.smy.tfs.common.utils.DateUtils;
import com.smy.tfs.openapi.service.ITicketDataServiceWrapper;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;

import javax.annotation.Resource;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

/**
 * @author z01140
 * @Package: com.smy.tfs.api.service
 * @Description:
 * @CreateDate 2024/5/9 15:18
 * @UpdateDate 2024/5/9 15:18
 */
@Slf4j
public class TicketDataOpenTest extends SpringTestCase {


    @Resource
    ITicketDataOpenService ticketDataOpenService;

    @Resource
    ITicketDataService ticketDataService;

    @Resource
    ITicketDataServiceWrapper ticketDataServiceWrapper;

    @Test
    public void test(){

        PageQueryTicketDataReqDto pageQueryTicketDataReqDto = new PageQueryTicketDataReqDto();
        pageQueryTicketDataReqDto.setTemplateId(null);
        pageQueryTicketDataReqDto.setTemplateCode("kefu_common_flow");
//        pageQueryTicketDataReqDto.setTicketId("54fcdab0-abcc-11ef-8e75-11b05e9b1d3a");
//        pageQueryTicketDataReqDto.setTicketStatusStrList(Arrays.asList("APPLY_END"));
//        pageQueryTicketDataReqDto.setQueryType(null);
//        String[] createTime= new String[2];
//        createTime[0] = "2024-11-25 00:00:00";
//        createTime[1] = "2024-11-27 23:59:59";
//        pageQueryTicketDataReqDto.setCreateTime(createTime);
//        String[] ticketFinishTime = new String[2];
//        ticketFinishTime[0] = "2024-11-26 00:00:00";
//        ticketFinishTime[1] = "2024-11-26 23:59:59";
//        pageQueryTicketDataReqDto.setTicketFinishTime(ticketFinishTime);
//        pageQueryTicketDataReqDto.setCreatedBy(Arrays.asList("admin","ry","ssssssssssss","luxiaomin","w01053"));
//        pageQueryTicketDataReqDto.setCurrentDoneUser(Arrays.asList("admin"));
        pageQueryTicketDataReqDto.setPageNum(1);
        pageQueryTicketDataReqDto.setPageSize(10);

        List<TicketFormItemAttriDto> formItemList = new ArrayList<>();
        TicketFormItemAttriDto t1 = new TicketFormItemAttriDto();
        t1.setFormItemLabel("真实创建人");
        t1.setFormItemValue("\"accountType\":\"ows\",\"accountId\":\"admin\",\"accountName\":\"若依\"");
        formItemList.add(t1);
//        TicketFormItemAttriDto t2 = new TicketFormItemAttriDto();
//        t2.setFormItemLabel("反馈渠道");
//        t2.setFormItemValue("0");
//        formItemList.add(t2);
//        TicketFormItemAttriDto t3 = new TicketFormItemAttriDto();
//        t3.setFormItemLabel("客户号");
//        t3.setFormItemValue("112");
//        formItemList.add(t3);
//
//        TicketFormItemAttriDto t4 = new TicketFormItemAttriDto();
//        t4.setFormItemLabel("优先级");
//        t4.setFormItemValue("0");
//        formItemList.add(t4);
//        TicketFormItemAttriDto t5 = new TicketFormItemAttriDto();
//        t5.setFormItemLabel("联系方式");
//        t5.setFormItemValue("150");
//        formItemList.add(t5);
//        TicketFormItemAttriDto t6 = new TicketFormItemAttriDto();
//        t6.setFormItemLabel("业务类型");
//        t6.setFormItemValue("340");
//        formItemList.add(t6);
//        TicketFormItemAttriDto t7 = new TicketFormItemAttriDto();
//        t7.setFormItemLabel("投诉日期");
//        t7.setFormItemValue("[\"2024-11-26 00:00:00\",\"2024-11-26 23:59:59\"]");
//        formItemList.add(t7);

        pageQueryTicketDataReqDto.setFormItemList(formItemList);

        ticketDataOpenService.pageQueryTicketList(pageQueryTicketDataReqDto, "ows", "admin", "若依");


    }

    @Test
    public void test1(){

        TicketFlowNodeApproveDetailDto ticketFlowNodeApproveDetailDto = new TicketFlowNodeApproveDetailDto();

        ticketFlowNodeApproveDetailDto.setId("1072411250006680009");
        Response<TicketFlowNodeApproveDetailDto> response = ticketDataOpenService.getTicketFlowNodeApproveDetailDto(ticketFlowNodeApproveDetailDto, "ldap", "y01781", "殷沙沙");
        System.out.println(response);

    }

    @Test
    public void test2(){

        AddTicketFlowNodeCommentDto atfncd = new AddTicketFlowNodeCommentDto();

        atfncd.setTicketDataId("9b5f1db0-ab9a-11ef-8e75-11b05e9b1d3a");
        atfncd.setDealContent("yss");
        atfncd.setCommentFileInfo("[{\"name\":\"通用文档模板.docx\",\"size\":\"36.54 KB\",\"url\":\"https://tx-srm-docker-03.smyjf.cn/fsp-oms/prddata/OWS_WorkSheetAttachment/101_fef8085bad514eb5081d48c74ff37d9e.docx\"}]");
        atfncd.setNodeId("1082411260008360002");
        AccountInfo accountInfo = new AccountInfo("y01781", "ldap", "y01781", "殷沙沙");
        Response<String> response = ticketDataService.comment(atfncd, accountInfo);
        System.out.println(response);

    }

    @Test
    public void test3(){
        BusiTicketDataRequestDto commonFieldsRequestDto = new BusiTicketDataRequestDto();
        commonFieldsRequestDto.setAppId("NCS");
        commonFieldsRequestDto.setTemplateIdList(Arrays.asList("tianxin_his_temp","inner_complain_temp"));
        commonFieldsRequestDto.setCreateStartTime(DateUtils.parseDate("2022-12-27 00:00:00"));
        commonFieldsRequestDto.setCreateEndTime(DateUtils.parseDate("2024-12-19 00:00:00"));
//        commonFieldsRequestDto.setFinishStartTime(DateUtils.parseDate("2024-12-12 00:00:00"));
//        commonFieldsRequestDto.setFinishEndTime(DateUtils.parseDate("2024-12-12 23:59:59"));
//        commonFieldsRequestDto.setApplyUser("admin");
//        commonFieldsRequestDto.setCurrentDealUser("admin");
//        commonFieldsRequestDto.setTicketStatusList(Arrays.asList("APPLYING"));
//        commonFieldsRequestDto.setCategoryIdList(Arrays.asList(90));
        commonFieldsRequestDto.setExtend1("160042482829");
//        commonFieldsRequestDto.setExtend2("2,5,4");
//        commonFieldsRequestDto.setExtend3("3");
//        commonFieldsRequestDto.setExtend4("4");
//        commonFieldsRequestDto.setExtend5("5");
//        commonFieldsRequestDto.setExtend6("6");
//        commonFieldsRequestDto.setExtend7("7");
//        commonFieldsRequestDto.setExtend8("8");
//        commonFieldsRequestDto.setExtend9("9");
//        commonFieldsRequestDto.setExtend10("10");
        Response<BusiTicketDataResponseDto> commonFieldsResponseDtoResponse = ticketDataServiceWrapper.queryBusiTicketDataList(commonFieldsRequestDto);
        System.out.println(commonFieldsResponseDtoResponse);
    }
}
